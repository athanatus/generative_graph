# Generative models for generating graphs

Generative models for graphs trained using power system graph data generated by SynGrid

This repository contains the code for creating the generative models for graphs as well as example data that was created using a MATLAB package SynGrid.

## Author and reference

- [@jwu2012](https://www.github.com/jwu2012): Jiaxin Wu is the original author of the code and the paper that is referenced below
  
Wu, Jiaxin, and Pingfeng Wang. "Generative design for resilience of interdependent network systems." Journal of Mechanical Design 145.3 (2023): 031705.

[Link to the paper](https://doi.org/10.1115/1.4056078)

## Output: Generated graph
Example of a 37 bus power system graph:
Figure created using python package NetworkX

![image](https://github.com/ibchung72/generative_graph/assets/119267318/e1fde51a-9db0-47de-851b-cfcd198f173e)

## Documentation
### Requirements
To allow users to freely access the code and try the training process, it is implemented in a Google Colab environment, where users are not required to have any installation for running the code. 
Python packages that are used in the code are installed and imported at the beginning blocks of the code.
If the user wishes to download the code and use it in a local environment, the following python packages must be installed
- tensorflow-gpu
- pandas
- numpy
- networkx

### How to use
Each ipynb (python notebook) file has text explanations before each code block to give users information about the functions of each part of the code.

### Preprocessing
If the dataset created by SynGrid is not processed yet, set the "load_and_save" to '1' in the third block. Afterwards, load the pickled file instead. 

* Processing the MATLAB data to extract features
  As the data is set in a MATLAB format, it is modified to a dataset that can be used in the standard python format through pandas.
  If the users network has different data structure, modify this section to fit the features of the data being used.

* Set graph parameters
  This block defines the number of nodes in the target graph and the dimensions of the node and edge features.
  The structure should be adjusted according to the preprocessing steps.

### Helper functions

#### get_adj_feat(data)
| Parameter | Type     | Description                       |
| :-------- | :------- | :-------------------------------- |
| `data`      | `list` | list of dataframes [node, edge, capacity] |

Converts the data = [node, edge, capacity] dataframe to [adjacency, features] tensors.

Adjacency tensor is structured as (edge feature, number of nodes, number of nodes) to define the connection relationship between nodes as well as the type of the edge connecting the nodes.

Feature tensor (matrix) is structured as (number of nodes, node features) to define the type for each node.

#### get_graph(adjacency, features)

Creates a graph using the adjacency tensor and features matrix from get_adj_feat

### Functions for generative modeling (GAN)

#### GraphGenerator(*params)
| Parameter | Type     | Description                       |
| :-------- | :------- | :-------------------------------- |
| `dense_units`      | `int list` | Keras: number of units for the fully connected layers |
| `dropout_rate`      | `float` | Keras: dropout layer |
| `latent_dim`      | `int` | Dimension of the latent space that the generative model sample |
| `adjacency_shape`      | `(int, int, int)` | Dimension of the adjacency tensor (edge information) |
| `feature_shape`      | `(int, int)` | Dimension of the feature matrix (node information) |

Create the generator of the GAN model

#### GraphDiscriminator(*params)
| Parameter | Type     | Description                       |
| :-------- | :------- | :-------------------------------- |
| `gconv_units`      | `int list` | Number of units for the relational graph convolutional layers |
| `dense_units`      | `int list` | Keras: number of units for the fully connected layers |
| `dropout_rate`      | `float` | Keras: dropout layer |
| `adjacency_shape`      | `(int, int, int)` | Dimension of the adjacency tensor (edge information) |
| `feature_shape`      | `(int, int)` | Dimension of the feature matrix (node information) |

Create the discriminator of the GAN model

#### class RelationalGraphConvLayer(keras.layers.Layer)

Define trainable layers of the network 

## MATLAB SynGrid
MATLAB SynGrid 
Refer to the repository for more details: [MATPOWER/SynGrid](https://github.com/MATPOWER/mx-syngrid)
